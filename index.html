<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>micro:bit UART Web Bluetooth</title>
</head>
<body style="text-align:center; font-family:sans-serif;">

  <h2>ส่งข้อมูลไปยัง micro:bit (Bluetooth UART)</h2>

  <button onclick="connect()">เชื่อมต่อ micro:bit</button>
  <br><br>

  <input id="msg" placeholder="พิมพ์ข้อความ" />
  <button onclick="send()">ส่งข้อมูล</button>

  <p id="status"></p>

<script>
let txChar;

async function connect() {
  try {
    const device = await navigator.bluetooth.requestDevice({
      filters: [{ namePrefix: 'BBC micro:bit' }],
      optionalServices: ['6e400001-b5a3-f393-e0a9-e50e24dcca9e']
    });

    const server = await device.gatt.connect();
    const service = await server.getPrimaryService(
      '6e400001-b5a3-f393-e0a9-e50e24dcca9e'
    );

    txChar = await service.getCharacteristic(
      '6e400002-b5a3-f393-e0a9-e50e24dcca9e'
    );

    document.getElementById("status").innerText = "✅ เชื่อมต่อสำเร็จ";
  } catch (err) {
    document.getElementById("status").innerText = "❌ " + err;
  }
}

async function send() {
  if (!txChar) {
    alert("ยังไม่ได้เชื่อมต่อ");
    return;
  }
  const text = document.getElementById("msg").value + "\n";
  const data = new TextEncoder().encode(text);
  await txChar.writeValue(data);
}
</script>

</body>
</html>
