<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>MPP3 | ‡∏£‡∏∞‡∏ö‡∏ö‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô</title>

<style>
body{
    margin:0;
    font-family: "Segoe UI", sans-serif;
    background: linear-gradient(120deg,#fff8cc,#dff3ff);
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
}

.card{
    background:#fff;
    width:420px;
    padding:35px;
    border-radius:24px;
    box-shadow:0 20px 40px rgba(0,0,0,0.15);
    text-align:center;
}

h1{
    color:#f4b400;
    font-size:48px;
    margin:0;
}

h2{
    color:#1a73e8;
    font-size:22px;
    margin:10px 0;
}

.school{
    font-size:15px;
    color:#444;
}

button{
    margin-top:25px;
    padding:14px 28px;
    border:none;
    border-radius:40px;
    font-size:18px;
    font-weight:bold;
    color:#000;
    background: linear-gradient(90deg,#f7d046,#5cc9f5);
    cursor:pointer;
}

button:hover{
    opacity:0.9;
}

.status{
    margin-top:18px;
    font-size:16px;
}

.status span{
    font-weight:bold;
}

.alert-box{
    margin-top:25px;
    border:2px dashed red;
    padding:22px;
    border-radius:16px;
    color:red;
    font-size:22px;
    font-weight:bold;
}

.footer{
    margin-top:20px;
    font-size:13px;
    color:#777;
}
</style>
</head>

<body>

<div class="card">
    <h1>MPP3</h1>
    <h2>‡∏£‡∏∞‡∏ö‡∏ö‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô</h2>
    <div class="school">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏û‡∏±‡∏ä‡∏£‡∏Å‡∏¥‡∏ï‡∏¥‡∏¢‡∏≤‡∏†‡∏≤ ‡πì ‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ</div>

    <button onclick="connect()">üîµ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ micro:bit</button>

    <div class="status">
        ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <span id="status">‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</span>
    </div>

    <div id="alert" class="alert-box">
        ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏...
    </div>

    <div class="footer">
        Emergency Assistance System | MPP3
    </div>
</div>

<script>
let device;
let rxChar;

async function connect(){
    try{
        device = await navigator.bluetooth.requestDevice({
            filters:[{namePrefix:'BBC micro:bit'}],
            optionalServices:['6e400001-b5a3-f393-e0a9-e50e24dcca9e']
        });

        const server = await device.gatt.connect();
        const service = await server.getPrimaryService(
            '6e400001-b5a3-f393-e0a9-e50e24dcca9e'
        );

        rxChar = await service.getCharacteristic(
            '6e400003-b5a3-f393-e0a9-e50e24dcca9e'
        );

        await rxChar.startNotifications();
        rxChar.addEventListener('characteristicvaluechanged', onReceive);

        document.getElementById("status").innerHTML = "‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
    }
    catch(err){
        document.getElementById("status").innerHTML =
            "‚ùå " + err.message;
    }
}

function onReceive(event){
    const value = new TextDecoder().decode(event.target.value).trim();
    console.log(value);

    if(value === "ten"){
        document.getElementById("alert").innerHTML =
            "üö® ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß!";
        document.getElementById("alert").style.color = "red";
    }
}
</script>

</body>
</html>
