<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏ (micro:bit)</title>

<style>
    body {
        font-family: Tahoma, sans-serif;
        background: #e3f2fd;
        text-align: center;
        padding: 30px;
    }
    .card {
        background: white;
        max-width: 420px;
        margin: auto;
        padding: 30px;
        border-radius: 20px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.15);
    }
    button {
        width: 100%;
        padding: 15px;
        font-size: 18px;
        border: none;
        border-radius: 10px;
        background: #1976d2;
        color: white;
        cursor: pointer;
        margin-top: 10px;
    }
    button:disabled {
        background: #aaa;
    }
    #status {
        margin-top: 15px;
        font-size: 14px;
        color: #555;
    }
    #emergency {
        display: none;
        background: #d32f2f;
        color: white;
        margin-top: 20px;
        padding: 20px;
        border-radius: 15px;
        animation: pulse 1s infinite;
    }
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }
</style>
</head>

<body>

<div class="card">
    <h2>üö® ‡∏£‡∏∞‡∏ö‡∏ö‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô</h2>
    <p>‡∏£‡∏±‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏à‡∏≤‡∏Å micro:bit ‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>

    <button id="connectBtn" onclick="connectMicrobit()">
        ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ micro:bit
    </button>

    <div id="status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</div>

    <div id="emergency">
        <h1>‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏!</h1>
        <p>‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠</p>
        <button onclick="resetAlert()" style="background:#fff;color:#d32f2f;">
            ‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö‡πÅ‡∏•‡πâ‡∏ß
        </button>
    </div>
</div>

<script>
// ===============================
// UUID ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö micro:bit UART
// ===============================
const UART_SERVICE_UUID = '6e400001-b5a3-f393-e0a9-e50e24dcca9e';
const UART_TX_UUID = '6e400003-b5a3-f393-e0a9-e50e24dcca9e';

let uartCharacteristic = null;

// ===============================
// ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ micro:bit
// ===============================
async function connectMicrobit() {
    try {
        document.getElementById("status").innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ micro:bit...";

        const device = await navigator.bluetooth.requestDevice({
            filters: [{ namePrefix: 'BBC micro:bit' }],
            optionalServices: [UART_SERVICE_UUID]
        });

        document.getElementById("status").innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...";

        const server = await device.gatt.connect();
        const service = await server.getPrimaryService(UART_SERVICE_UUID);
        uartCharacteristic = await service.getCharacteristic(UART_TX_UUID);

        await uartCharacteristic.startNotifications();
        uartCharacteristic.addEventListener(
            'characteristicvaluechanged',
            onDataReceived
        );

        document.getElementById("status").innerText =
            "‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úî ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì";
        document.getElementById("status").style.color = "green";
        document.getElementById("connectBtn").disabled = true;

    } catch (error) {
        alert("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + error);
        console.error(error);
        document.getElementById("status").innerText = "‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß";
    }
}

// ===============================
// ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å micro:bit
// ===============================
function onDataReceived(event) {
    const value = new TextDecoder().decode(event.target.value);
    console.log("‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:", value);

    if (value.includes("ten")) {
        showEmergency();
    }
}

// ===============================
// ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏
// ===============================
function showEmergency() {
    const box = document.getElementById("emergency");
    box.style.display = "block";

    if ("vibrate" in navigator) {
        navigator.vibrate([500, 200, 500, 200, 500]);
    }
}

// ===============================
// ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏
// ===============================
function resetAlert() {
    document.getElementById("emergency").style.display = "none";
}
</script>

</body>
</html>
